\documentclass[]{jsarticle}
%% \setlength{\textheight}{37\baselineskip} % 11pt
%% \setlength{\textheight}{35\baselineskip} % 12pt

%% font
\usepackage[T1]{fontenc} % 8ビットエンコーディング <,|,> の直書き
\usepackage{textcomp} % 文字種追加
\usepackage[deluxe]{otf} % 文字種追加

%% math
\usepackage{amsmath,amssymb} % 数学記号の追加
\usepackage{bm} % 数式の太字 \bm{}
\usepackage{cancel} % 数式に打ち消し合いを示すための斜め線

%% table
\usepackage{array} % tabular拡張
\usepackage{multirow}

%% figure
\usepackage[dvipdfmx]{graphicx}
\usepackage{float}

\usepackage{listings}
\lstset{
%% language=Scheme,
  basicstyle=\ttfamily,
%  frame=tbrl, %枠を上下左右に表示
  breaklines=true, % 行が長くなった場合に改行
  numbers=left,
  xleftmargin=2zw,
}
\usepackage{url}

\catcode`@=\active
\def@#1@{\texttt{#1}}

%% レイアウト
% title補正
\addtolength{\textheight}{\topskip}
\setlength{\voffset}{0pt}
\setlength{\topmargin}{0pt}
\setlength{\headheight}{0pt}
\setlength{\headsep}{0pt}
% \pagestyle{empty} % ページ番号非表示

\title{集積システム入門　SPICE実習(2)}
\author{横井 祥（よこい しょう）\\
学籍番号：\texttt{1029-23-2177}\\
工学部 情報学科 計算機科学コース 3回生\\
計算機のログインID：\texttt{a0088580}}
%% \title{English IIA E2T01; Professor Hayashi, Brian\\Homework \#1}
%% \author{Yokoi, Sho; 1029-23-2177} % ほか
\date{2013年12月24日}\西暦
\begin{document}
\maketitle
%% \tableofcontents % 目次の表示

\section{回路(a) I+NAND4+I}
\subsection{回路図・トランジスタのサイズ}

回路(a) の回路図は図\ref{fig:circuit1}の通り。

なお、各トランジスタのサイズは 表\ref{tb:circuit1-1}、 表\ref{tb:circuit1-2} に従って計算した。

\begin{figure}[htbp]
  \centering
  \includegraphics[width=0.95\textwidth,height=0.95\textheight,keepaspectratio]{circuit1.pdf}
  \caption{回路(a)}
  \label{fig:circuit1}
\end{figure}

\begin{table}
  \caption{回路(a)のトランジスタのサイズの計算 - 1}
  \label{tb:circuit1-1}
  \begin{center}
    \setlength{\tabcolsep}{3pt}
    \footnotesize
\begin{tabular}{llll}
\textbf{F.O.(all)} & \textbf{L.E.(all)} & \textbf{Gain(all)} & \textbf{Gain/step}\\
= Load-Cap. / Input-Cap & = prod(L.E.) & = F.O.(all) * L.E.(all) & = Gain(all) \^{} (1/num of steps)\\
\hline
20 & 2 & 40 & 3.419951893\\
\end{tabular}
  \end{center}
\end{table}%

\begin{table}
  \caption{回路(a)のトランジスタのサイズの計算 - 2}
  \label{tb:circuit1-2}
  \begin{center}
    \setlength{\tabcolsep}{3pt}
    \footnotesize
\begin{tabular}{lrrrrr}
 &  & invin & nand4 & invfirst & invout\\
\hline
L.E. &  & 1.00 & 2.00 & 1.00 & 1.00\\
Gain &  & 3.42 & 3.42 & 3.42 & 3.42\\
F.O. &  & 3.42 & 1.71 & 3.42 & 3.42\\
Input-Cap(um) &  & 6.00 & 20.52 & 35.09 & 120.00\\
Load-Cap(um) & 6 & 20.52 & 35.09 & 120.00 & 410.39\\
PMOS(ratio) &  & 2 & 2 & 2 & 2\\
NMOS(ratio) &  & 1 & 4 & 1 & 1\\
PMOS(um) &  & \textbf{4.00000} & \textbf{6.83990} & \textbf{23.39214} & \textbf{80.00000}\\
NMOS(um) &  & \textbf{2.00000} & \textbf{13.67981} & \textbf{11.69607} & \textbf{40.00000}\\
\end{tabular}
  \end{center}
\end{table}%


\subsection{最大遅延時間と、それを与えた入力および立ち上がり/立ち下がりの別}
\begin{table}
  \caption{回路(a)の最大遅延時間}
  \label{}
  \begin{center}
    \setlength{\tabcolsep}{3pt}
    \footnotesize
\begin{tabular}{llrrrrr}
 &  & time & v(X*) & time & v(F) & delay\\
\hline
XA & 立ち上がり & 1.05 E-09 & 1.25\,(+00) & 1.43\,(-09) & 1.25\,(+00) & 3.80\,(-10)\\
 & 立ち下がり & 5.15\,(-09) & 1.25\,(+00) & 5.45\,(-09) & 1.25\,(+00) & 3.00\,(-10)\\
XB & 立ち上がり & 9.05\,(-09) & 1.25\,(+00) & 9.46\,(-09) & 1.25\,(+00) & 4.13\,(-10)\\
 & 立ち下がり & 1.32\,(-08) & 1.25\,(+00) & 1.35\,(-08) & 1.25\,(+00) & 3.20\,(-10)\\
XC & 立ち上がり & 1.71\,(-08) & 1.25\,(+00) & 1.75\,(-08) & 1.25\,(+00) & 4.40\,(-10)\\
 & 立ち下がり & 2.12\,(-08) & 1.25\,(+00) & 2.15\,(-08) & 1.26\,(+00) & 3.30\,(-10)\\
XD & 立ち上がり & 2.51\,(-08) & 1.25\,(+00) & 2.55\,(-08) & 1.25\,(+00) & \textbf{4.70E-10}\\
 & 立ち下がり & 2.92\,(-08) & 1.25\,(+00) & 2.95\,(-08) & 1.24\,(+00) & 3.40\,(-10)\\
\hline
 &  &  &  &  &  & \textbf{4.7E-10}\\
\end{tabular}
  \end{center}
\end{table}%


\newpage
\subsection{シミュレーション結果}
$f=1,2,4,8$の各インバータのシミュレーション結果を示す。

各表は、それぞれ
\begin{itemize}
\item $time,v(a)$: 入力が$1.25V$を横切る時間
\item $time,v(b)$: 出力が$1.25V$を横切る時間
\item $delay$: その差
\end{itemize}
について、
\begin{itemize}
\item 立ち上がり
\item 立ち下がり
\item 平均（$delay$のみ）
\end{itemize}
を示したものである。

\subsubsection*{$f=1$}
\begin{center}
\begin{tabular}{rrrrr}
time & v(a) & time & v(y) & delay\\
\hline
1.049e-09 & 1.225e+00 & 1.101e-09 & 1.286e+00 & \\
1.050e-09 & 1.250e+00 & 1.102e-09 & 1.246e+00 & 5.2e-11\\
1.051e-09 & 1.275e+00 & 1.103e-09 & 1.205e+00 & \\
\hline
5.149e-09 & 1.275e+00 & 5.215e-09 & 1.229e+00 & \\
5.150e-09 & 1.250e+00 & 5.216e-09 & 1.260e+00 & 6.6e-11\\
5.151e-09 & 1.225e+00 & 5.217e-09 & 1.291e+00 & \\
\hline
 &  &  &  & {\bf 5.9e-11}\\
\end{tabular}
\end{center}

\subsubsection*{$f=2$}
\begin{center}
\begin{tabular}{rrrrr}
time & v(a)& time & v(y)& delay\\
\hline
1.049e-09 & 1.225e+00 & 1.125e-09 & 1.278e+00 & \\
1.050e-09 & 1.250e+00 & 1.126e-09 & 1.256e+00 & 7.6e-11\\
1.051e-09 & 1.275e+00 & 1.127e-09 & 1.234e+00 & \\
\hline
5.149e-09 & 1.275e+00 & 5.246e-09 & 1.241e+00 & \\
5.150e-09 & 1.250e+00 & 5.247e-09 & 1.258e+00 & 9.7e-11\\
5.151e-09 & 1.225e+00 & 5.248e-09 & 1.275e+00 & \\
\hline
 &  &  &  & {\bf 8.65e-11}\\
\end{tabular}
\end{center}

\subsubsection*{$f=4$}
\begin{center}
\begin{tabular}{rrrrr}
time & v(a)& time & v(y)& delay\\
\hline
1.049e-09 & 1.225e+00 & 1.174e-09 & 1.259e+00 & \\
1.050e-09 & 1.250e+00 & 1.175e-09 & 1.247e+00 & 1.25e-10\\
1.051e-09 & 1.275e+00 & 1.176e-09 & 1.236e+00 & \\
\hline
5.149e-09 & 1.275e+00 & 5.308e-09 & 1.244e+00 & \\
5.150e-09 & 1.250e+00 & 5.309e-09 & 1.253e+00 & 1.59e-10\\
5.151e-09 & 1.225e+00 & 5.310e-09 & 1.261e+00 & \\
 &  &  &  & {\bf 1.42e-10}\\
\end{tabular}
\end{center}

\subsubsection*{$f=4$}
\begin{center}
\begin{tabular}{rrrrr}
time & v(a)& time & v(y)& delay\\
\hline
1.049e-09 & 1.225e+00 & 1.270e-09 & 1.258e+00 & \\
1.050e-09 & 1.250e+00 & 1.271e-09 & 1.252e+00 & 2.21e-10\\
1.051e-09 & 1.275e+00 & 1.272e-09 & 1.246e+00 & \\
\hline
5.149e-09 & 1.275e+00 & 5.432e-09 & 1.246e+00 & \\
5.150e-09 & 1.250e+00 & 5.433e-09 & 1.251e+00 & 2.83e-10\\
5.151e-09 & 1.225e+00 & 5.434e-09 & 1.255e+00 & \\
\hline
 &  &  &  & {\bf 2.52e-10}\\
\end{tabular}
\end{center}

\subsection{$f$と$delay$の関係式}
シミュレーションで得られた$f$と$delay$の関係は以下の通り。
\begin{center}
\begin{tabular}{rr}
f & delay \\
\hline
1 & 5.9e-11 \\ 
2 & 8.65e-11\\ 
4 & 1.42e-10\\ 
8 & 2.52e-10\\ 
\end{tabular}
\end{center}

\bigskip
\begin{equation*}
delay = a + b \times f
\end{equation*}
となるよう最小二乗法でフィッティングすると、
\begin{eqnarray*}
a = 3.14565 \times 10^{-11}\\
b = 2.75783 \times 10^{-11}
\end{eqnarray*}
と分かる。

\bigskip
この$a,b$による$delay$の近似は下表の通り。
\begin{center}
\begin{tabular}{rrr}
f & delay & a + b f\\
\hline
1 & 5.9e-11 & 5.90348e-11\\
2 & 8.65e-11 & 8.6613e-11\\
4 & 1.42e-10 & 1.4177e-10\\
8 & 2.52e-10 & 2.52083e-10\\
\end{tabular}
\end{center}

\subsection{SPICEファイル}
シミュレーションに用いたSPICEファイルを以下に添付する。
\verb|Top level simulation netlist|内を一部コメントアウトすることで、3種のシミュレーションをすべてこのファイルでおこなった。

添付は、3番目の回路（\verb|INV→NAND2→NOR2|）のシミュレーションに用いたものである。
\lstinputlisting[
% caption=inv8.cir
breaklines=false, % 行が長くなった場合の改行
]{cir.cir}

\bigskip
\begin{flushright}
以上
\end{flushright}
\end{document}
